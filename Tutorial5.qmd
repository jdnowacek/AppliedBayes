---
title: "Tutorial5"
format: html
editor: 
  markdown: 
    wrap: 80
---

# Packages and Data

```{r, message= F}
library(tidyverse)
library(nimble)
library(coda)
```

Consider birth weight data ğ‘¤ = (ğ‘¤1, ..., ğ‘¤200), in Kg, from 200 births at
Hospital H. The data are given in the R workspace file Birth_weights_Tutorial_3
in the Tutorials folder in Moodle. The data file also contains binary
information on the Index of Multiple Deprivation (IMD) of the mother. 0 denotes
high deprivation (index from 1 to 5), while 1 denotes low deprivation (index
from 6 to 10). Note the counter-intuitive interpretation of the IMD values on
the scale from 1 to 10, and subsequently on the binary scale.

```{r, message=FALSE}
load("~/Documents/St. Andrews/Bayes/AppliedBayes/Birth_weights_Tutorial_3.RData")

d <- as.data.frame(birth_weights) |>
  mutate(j = seq(1, length(birth_weights), 1))

d2 <- as.data.frame(IMD_binary)|>
  mutate(j = seq(1, length(IMD_binary), 1))

d <- left_join(d, d2) |>
  mutate(bw = birth_weights,
         imd = IMD_binary,
         imd_plot = ifelse(imd == 1, "Low", "High")) |>
  select(-c(j, birth_weights, IMD_binary))

remove(d2, birth_weights, IMD_binary)
```

Fit a linear model with the birth weights ğ‘¤ğ‘– , ğ‘– = 1, ..., 200 as the outcome
that follows a Normal distribution so that (given ğœ‡ğ‘– and ğœ), (ğ‘¤ğ‘– \|ğœ‡ğ‘– , ğœ âˆ¼ ğ‘(ğœ‡ğ‘–
, ğœ2 )), with the weights being independent. Center the continuous covariates
age and pm2_5, creating two new covariates, say, **cage** and **cpm2_5**
Overall, the covariates should be the binary IMD variable, as well as the
centered **cage** and **cpm2_5**.

Parametrise the mean ğœ‡ğ‘– for birth weight ğ‘¤ğ‘– so that,

ğœ‡ğ‘– = ğ›½0 + ğ›½1 âˆ— ğ¼ğ‘€ğ·ğ‘– + ğ›½2 âˆ— ğ‘ğ‘ğ‘”ğ‘’ + ğ›½3 âˆ— ğ‘ğ‘ğ‘š2_5.

Place a ğ¿ğ‘œğ‘” âˆ’ ğ‘ğ‘œğ‘Ÿğ‘šğ‘ğ‘™(1, 0.72 ) prior on ğ›½0 . Place suitably non-informative
priors on ğ›½1 , ğ›½2 and ğ›½3 . For the precision ğœ = 1/ğœ2 , we will assume a Gamma
prior distribution ğº(0.1, 0.1).

Use Nimble to derive the posterior distribution ğœ‹(ğ›½0 , ğ›½1 , ğ›½2 , ğ›½3 , ğœ2 \|ğ‘¤).
Run 2 chains. Consider a burn-in of 100000 iterations, with 400000 further
iterations for each chain. Thin by 10.

Obtain plots of the posterior distributions and diagnostic plots. Check the MCMC
convergence, not forgetting to check the chains length in relation to the
autocorrelations and MC error.

Answer the following questions, to an accuracy of 3 decimal places where
appropriate. (Note that you should also be checking model assumptions and model
fit before reporting inferences, but this will be one of the topics in the next
tutorial sheet.)

a\) Posterior inferences can be trusted, considering convergence and mixing. Is
this statement true or false? \[1 mark\]

b) Considering births at hospital H in general, state the estimated mean birth
weight for parents classified within then high-deprivation band, of average age,
with an exposure to PM2.5 that is also average. \[1 mark\]

c) Provide the left limit of the 95% credible interval for the estimate in (b).
\[1 mark\]

d) Provide the right limit of the 95% credible interval for the estimate in (b).
\[1 mark\]

e) State the predicted weight for a specific birth from a mother that is
classified within the low-deprivation band, is 29 years old, and their exposure
to PM2.5 is 16 ğœ‡ğ‘”/ğ‘š3. \[1mark\]

f) Provide the left limit of the 95% credible interval for the prediction in
(e). \[1 mark\]

g) Provide the right limit of the 95% credible interval for the prediction in
(e). \[1 mark\]

h) Describe to someone with no statistical knowledge the effect of the model
covariates,
considering the interpretation of the estimates for ğ›½0, ğ›½1, ğ›½2, ğ›½3. \[3 marks\]

i) Comment on how important each one of the covariates seems to be for the
modelling of
birth weights. \[2 marks\]
